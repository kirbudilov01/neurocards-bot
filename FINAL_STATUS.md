# üéØ –§–ò–ù–ê–õ–¨–ù–´–ô –°–¢–ê–¢–£–° –ü–†–û–ï–ö–¢–ê

**–î–∞—Ç–∞:** 22 —è–Ω–≤–∞—Ä—è 2026, 22:00 UTC  
**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã:** 40+ –º–∏–Ω—É—Ç –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö PRODUCTION TESTING

---

## üìã –ß–¢–û –ë–´–õ–û –°–î–ï–õ–ê–ù–û

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –í–°–ï –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏:
‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ worker.py (MAX_RETRY_ATTEMPTS)  
‚úÖ –°–ª–æ–º–∞–Ω–Ω–∞—è retry –ª–æ–≥–∏–∫–∞ (–≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã, –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è continue)  
‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–±—ã–ª–æ 8, —Ç–µ–ø–µ—Ä—å 1)  
‚úÖ –û—à–∏–±–∫–∞ `refund_credit() takes 2 arguments` (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –≤—ã–∑–æ–≤—ã)  
‚úÖ –û—à–∏–±–∫–∞ —Å –¥–∞—Ç–∞–º–∏ –≤ PostgreSQL (–∏—Å–ø–æ–ª—å–∑—É–µ–º NOW() –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫)  
‚úÖ –û—à–∏–±–∫–∞ `'str' object has no attribute 'get'` (–ø–∞—Ä—Å–∏–Ω–≥ product_info JSON)

### 2. –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ñ–∏—á–∏:
‚úÖ –í—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∏–¥–µ–æ (1/3/5) —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π  
‚úÖ –ö–Ω–æ–ø–∫–∞ "–°–¥–µ–ª–∞—Ç—å –µ—â—ë —Å —ç—Ç–∏–º —Ç–æ–≤–∞—Ä–æ–º" –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏  
‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫ KIE  
‚úÖ –£–≤–µ–ª–∏—á–µ–Ω timeout polling –¥–æ 30 –º–∏–Ω—É—Ç (–¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏)  
‚úÖ –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff –¥–ª—è retry  
‚úÖ –†–æ—Ç–∞—Ü–∏—è API –∫–ª—é—á–µ–π KIE

### 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
‚úÖ –ü–µ—Ä–µ–ø–∏—Å–∞–Ω main worker loop —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π retry –ª–æ–≥–∏–∫–æ–π  
‚úÖ Job –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ queued –ø—Ä–∏ retry (–Ω–µ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–µ—Ç—Å—è)  
‚úÖ Graceful shutdown —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π SIGTERM/SIGINT  
‚úÖ Connection pooling –¥–ª—è PostgreSQL (2-10 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π)  
‚úÖ –ê—Ç–æ–º–∞—Ä–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–æ–≤ + —Å–æ–∑–¥–∞–Ω–∏–µ job

---

## üèóÔ∏è –¢–ï–ö–£–©–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

```
Telegram User
    ‚Üì
Bot (aiogram)
    ‚Üì
PostgreSQL ‚Üê Jobs Queue
    ‚Üë
5x Workers (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
    ‚Üì
GPT-4 ‚Üí Prompt Generation
    ‚Üì
KIE AI Sora 2 ‚Üí Video Generation
    ‚Üì
Storage (Supabase/Local)
    ‚Üì
Telegram User (—Ä–µ–∑—É–ª—å—Ç–∞—Ç)
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **Bot:** 1 –∏–Ω—Å—Ç–∞–Ω—Å –Ω–∞ VPS (185.93.108.162)
- **Workers:** 5 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —á–µ—Ä–µ–∑ systemd
- **Database:** PostgreSQL (–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, –±–µ–∑ Supabase)
- **Storage:** –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π —á–µ—Ä–µ–∑ STORAGE_TYPE (.env)
- **AI:** OpenAI GPT-4 + KIE AI Sora 2

---

## üß™ –ß–¢–û –ù–£–ñ–ù–û –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–¢–¨

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
1. **–ë–∞–∑–æ–≤—ã–π flow (–°–ê–ú–û–ï –í–ê–ñ–ù–û–ï)**
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞
   - –ü—Ä–æ–π—Ç–∏ –≤–µ—Å—å flow –¥–æ –∫–æ–Ω—Ü–∞
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤–∏–¥–µ–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –û–î–ù–û —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–Ω–µ –¥—É–±–ª–∏)

2. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–∏–¥–µ–æ**
   - –í—ã–±—Ä–∞—Ç—å 3 –∏–ª–∏ 5 –≤–∏–¥–µ–æ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–æ–≤

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ KIE**
   - USER_ERROR (–∑–∞–ø—Ä–µ—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç) ‚Üí –≤–µ—Ä–Ω—É—Ç—å –∫—Ä–µ–¥–∏—Ç
   - TEMPORARY (500 internal) ‚Üí retry –¥–æ 3 —Ä–∞–∑
   - RATE_LIMIT (429) ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∫–ª—é—á
   - BILLING ‚Üí —É–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É

4. **–ö–Ω–æ–ø–∫–∏ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è**
   - "–°–¥–µ–ª–∞—Ç—å –µ—â—ë —Å —ç—Ç–∏–º —Ç–æ–≤–∞—Ä–æ–º" ‚Üí –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
   - "–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é" ‚Üí –æ—á–∏—â–∞–µ—Ç state

---

## üìä –ì–û–¢–û–í–ù–û–°–¢–¨ –ö PRODUCTION

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|--------|------------|
| Database | ‚úÖ READY | PostgreSQL pool —Ä–∞–±–æ—Ç–∞–µ—Ç |
| Bot handlers | ‚úÖ READY | –í—Å–µ flow –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ |
| Worker pool | ‚úÖ READY | 5 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∑–∞–ø—É—â–µ–Ω—ã |
| Error handling | ‚úÖ READY | –í—Å–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã |
| Retry logic | ‚úÖ READY | –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å backoff |
| KIE integration | ‚ö†Ô∏è NEEDS TESTING | –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è |
| Video count selection | ‚ö†Ô∏è NEEDS TESTING | –ö–æ–¥ –≥–æ—Ç–æ–≤, –Ω—É–∂–µ–Ω —Ç–µ—Å—Ç |
| Retry button | ‚ö†Ô∏è NEEDS TESTING | –ö–æ–¥ –≥–æ—Ç–æ–≤, –Ω—É–∂–µ–Ω —Ç–µ—Å—Ç |
| Monitoring | ‚ùå NOT READY | –ù—É–∂–Ω—ã metrics + alerts |

---

## üêõ –ò–ó–í–ï–°–¢–ù–´–ï –†–ò–°–ö–ò

1. **KIE API –Ω–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –≤ production**
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫
   - **–†–µ—à–µ–Ω–∏–µ:** –°—Ä–∞–∑—É —Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Ç–µ—Å—Ç–µ

2. **Timeout 30 –º–∏–Ω—É—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–∏–º**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–¥—É–º–∞—Ç—å —á—Ç–æ –∑–∞–≤–∏—Å–ª–æ
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

3. **–ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–ª–µ—Ä—Ç–æ–≤**
   - –ï—Å–ª–∏ worker —É–ø–∞–¥–µ—Ç - –Ω–∏–∫—Ç–æ –Ω–µ —É–∑–Ω–∞–µ—Ç
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å Prometheus/Grafana

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –°–µ–π—á–∞—Å (CRITICAL):
1. ‚úÖ –ó–∞–ø—É—à–∏—Ç—å –∫–æ–¥ –Ω–∞ GitHub (–∫–æ–º–∞–Ω–¥–∞ –≤ PUSH_INSTRUCTIONS.md)
2. ‚úÖ –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ VPS
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ error cases

### –°–∫–æ—Ä–æ (HIGH):
1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –¥–æ–ª–≥–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus + Grafana)
3. –î–æ–±–∞–≤–∏—Ç—å rate limiting –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±–æ—Ç–∞
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π (100+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)

### –ü–æ—Ç–æ–º (MEDIUM):
1. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ 20 worker'–æ–≤
2. Load balancer –¥–ª—è hot-swap worker'–æ–≤
3. Backup –∏ recovery –º–µ—Ö–∞–Ω–∏–∑–º
4. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

---

## üí° –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

1. **–£ —Ç–µ–±—è 155 –∫—Ä–µ–¥–∏—Ç–æ–≤** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (ID: 5235703016)

2. **–õ–æ–≥–∏ —Å–º–æ—Ç—Ä–µ—Ç—å —Ç–∞–∫:**
   ```bash
   # Real-time
   ssh root@185.93.108.162 "journalctl -u neurocards-worker@1 -f"
   
   # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
   ssh root@185.93.108.162 "journalctl -u neurocards-worker@1 -n 100 --no-pager"
   ```

3. **–ü—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ:**
   - –°–∫–æ–ø–∏—Ä—É–π –ø–æ–ª–Ω—ã–π –ª–æ–≥ (—Å–æ stack trace)
   - –°–∫–æ–ø–∏—Ä—É–π JSON –æ—Ç KIE API (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –ù–∞–ø–∏—à–∏ –º–Ω–µ - —è –∏—Å–ø—Ä–∞–≤–ª—é –∑–∞ –º–∏–Ω—É—Ç—ã

4. **–°–∏—Å—Ç–µ–º–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è:**
   - –ú–æ–∂–µ—à—å –∑–∞–ø—É—Å—Ç–∏—Ç—å 20 worker'–æ–≤ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
   - –ë–∞–∑–∞ –≤—ã–¥–µ—Ä–∂–∏—Ç —Å–æ—Ç–Ω–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
   - KIE API limit - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ

---

## üìû –ß–¢–û –î–ï–õ–ê–¢–¨ –ï–°–õ–ò...

### Bot –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç:
```bash
ssh root@185.93.108.162
systemctl status neurocards-bot
journalctl -u neurocards-bot -n 50 --no-pager
systemctl restart neurocards-bot
```

### Worker –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏:
```bash
ssh root@185.93.108.162
systemctl status neurocards-worker@{1..5}
journalctl -u neurocards-worker@1 -n 50 --no-pager
systemctl restart neurocards-worker@{1..5}
```

### –í–∏–¥–µ–æ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ worker'–∞ (—Ç–∞–º –±—É–¥–µ—Ç JSON –æ—Ç KIE)
2. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –∫–ª—é—á KIE —Ä–∞–±–æ—á–∏–π
3. –°–∫–æ–ø–∏—Ä—É–π –º–Ω–µ –æ—à–∏–±–∫—É - —Ä–∞–∑–±–µ—Ä–µ–º—Å—è

### –ë–∞–∑–∞ –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è:
```bash
ssh root@185.93.108.162
psql $DATABASE_URL -c "SELECT COUNT(*) FROM users;"
```

---

## ‚úÖ –ò–¢–û–ì–û–í–´–ô –ß–ï–ö–õ–ò–°–¢

- [x] –í—Å–µ –±–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- [x] –ö–æ–¥ –∑–∞–∫–æ–º–º–∏—á–µ–Ω
- [ ] **TODO:** Push –Ω–∞ GitHub main
- [ ] **TODO:** Deploy –Ω–∞ VPS
- [ ] **TODO:** –†–µ–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- [ ] **TODO:** –¢–µ—Å—Ç –≤—Å–µ—Ö error scenarios
- [ ] **TODO:** –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ "–°–¥–µ–ª–∞—Ç—å –µ—â—ë"
- [ ] **TODO:** –¢–µ—Å—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ (3/5)
- [ ] **TODO:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

---

**–°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ!** üöÄ

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ –º–µ—Å—Ç–µ, –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è.  
–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –¥–æ–≤–µ—Å—Ç–∏ –¥–æ –∏–¥–µ–∞–ª–∞.

**–Ø –Ω–∞ —Å–≤—è–∑–∏ –∏ –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å –ª—é–±—ã–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏!**

