# üìä METABASE DASHBOARD - –ò–ù–°–¢–†–£–ö–¶–ò–Ø

## üéØ –ß–¢–û –°–î–ï–õ–ê–ù–û

### 1. **–°—Ö–µ–º–∞ –ë–î —Ä–∞—Å—à–∏—Ä–µ–Ω–∞**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–±–ª–∏—Ü—ã `pricing_plans` –∏ `payments`  
- ‚úÖ –¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã –≥–æ—Ç–æ–≤—ã (5 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç 500‚ÇΩ –¥–æ 9900‚ÇΩ)
- ‚úÖ RPC —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- üí° **–§–∏–Ω–∞–Ω—Å—ã –ø–æ–∫–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ –¥–∞—à–±–æ—Ä–¥–µ** (–¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç)

### 2. **SQL –∑–∞–ø—Ä–æ—Å—ã –≥–æ—Ç–æ–≤—ã –¥–ª—è 8 –∫–∞—Ä—Ç–æ—á–µ–∫:**
- ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ 0: –ì–ª–∞–≤–Ω–∞—è —Å–≤–æ–¥–∫–∞ (14 –º–µ—Ç—Ä–∏–∫)
- ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ 3: –ö–∞—á–µ—Å—Ç–≤–æ
- ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ 5: –í–æ—Ä–æ–Ω–∫–∞ (–ë–ï–ó –ø–ª–∞—Ç–µ–∂–µ–π)
- ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ 6: –°–∫–æ—Ä–æ—Å—Ç—å
- ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ 7: –ù–∞–≥—Ä—É–∑–∫–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è)
- ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ 8: –û—à–∏–±–∫–∏ (—Ç–æ–ø-5)

### 3. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: 3 –≥—Ä–∞—Ñ–∏–∫–∞**
- –ì—Ä–∞—Ñ–∏–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –ø–æ –¥–Ω—è–º
- –ì—Ä–∞—Ñ–∏–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
- –ì—Ä–∞—Ñ–∏–∫ Success Rate

---

## üöÄ –ö–ê–ö –ü–†–ò–ú–ï–ù–ò–¢–¨

### –®–ê–ì 1: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É –ë–î (–¥–æ–±–∞–≤–∏—Ç—å payments)

```bash
# –ù–∞ VPS
ssh root@185.93.108.162

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é —Å—Ö–µ–º—É
docker exec neurocards-postgres sh -c "PGPASSWORD=\$POSTGRES_PASSWORD psql -U neurocards -d neurocards" < /path/to/schema_extended.sql
```

### –®–ê–ì 2: –û—Ç–∫—Ä—ã—Ç—å Metabase

Metabase –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞: **http://185.93.108.162:3000**

### –®–ê–ì 3: –°–æ–∑–¥–∞—Ç—å –¥–∞—à–±–æ—Ä–¥

1. **New ‚Üí Dashboard** ‚Üí "Neurocards Analytics"

2. **–î–ª—è –ö–ê–ñ–î–û–ô –∫–∞—Ä—Ç–æ—á–∫–∏:**
   - –ù–∞–∂–∞—Ç—å "+" ‚Üí "Question"
   - –í—ã–±—Ä–∞—Ç—å "Native query" (SQL)
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å SQL –∑–∞–ø—Ä–æ—Å –∏–∑ —Ñ–∞–π–ª–∞ `metabase_queries.sql`
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å
   - –î–æ–±–∞–≤–∏—Ç—å –Ω–∞ dashboard

---

## üìã –°–¢–†–£–ö–¢–£–†–ê –î–ê–®–ë–û–†–î–ê

### üè† **–†–ê–ó–î–ï–õ 1: OVERVIEW** (–≤–µ—Ä—Ö —Å—Ç—Ä–∞–Ω–∏—Ü—ã)

–ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–∏–ø–∞ "Number" (–±–æ–ª—å—à–∏–µ —Ü–∏—Ñ—Ä—ã):

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üë• –í—Å–µ–≥–æ‚îÇ üìπ –í—Å–µ–≥–æ‚îÇ ‚úÖ Success‚îÇ ‚ö° p50 ‚îÇ
‚îÇ  users  ‚îÇ  jobs   ‚îÇ   Rate   ‚îÇ  –≤—Ä–µ–º—è ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üë§ –ù–æ–≤—ã—Ö‚îÇ ‚úÖ –£—Å–ø–µ—Ö‚îÇ ‚ùå Failed‚îÇ üìä Jobs/—á‚îÇ
‚îÇ  30–¥    ‚îÇ  jobs   ‚îÇ   Rate   ‚îÇ        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üìä **–†–ê–ó–î–ï–õ 2: –¢–ê–ë–õ–ò–¶–´** (—Å–µ—Ä–µ–¥–∏–Ω–∞)

4 —Ç–∞–±–ª–∏—Ü—ã –ø–æ 2 –≤ —Ä—è–¥:
1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** (—Ç–∞–±–ª–∏—Ü–∞ 2√ó4)
2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏–∏** (—Ç–∞–±–ª–∏—Ü–∞ 3√ó4)
3. **–ö–∞—á–µ—Å—Ç–≤–æ** (—Ç–∞–±–ª–∏—Ü–∞ 3√ó4)
4. **–í–æ—Ä–æ–Ω–∫–∞** (2 —Ç–∞–±–ª–∏—Ü—ã: –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ + –∫–æ–Ω–≤–µ—Ä—Å–∏–∏)

### ‚ö° **–†–ê–ó–î–ï–õ 3: –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨**

2 —Ç–∞–±–ª–∏—Ü—ã:
1. **–°–∫–æ—Ä–æ—Å—Ç—å** (–ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, 4√ó3)
2. **–ù–∞–≥—Ä—É–∑–∫–∞** (throughput, 4√ó3)

### ‚ùå **–†–ê–ó–î–ï–õ 4: –û–®–ò–ë–ö–ò**

1 —Ç–∞–±–ª–∏—Ü–∞:
- **–¢–æ–ø-5 –æ—à–∏–±–æ–∫** —Å —Ç—Ä–µ–Ω–¥–∞–º–∏

### üìà **–†–ê–ó–î–ï–õ 5: –ì–†–ê–§–ò–ö–ò** (–Ω–∏–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)

3 –ª–∏–Ω–µ–π–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞:
1. –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (3 –ª–∏–Ω–∏–∏: –≤—Å–µ–≥–æ/—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∏)
2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
3. Success Rate trend

---

## üé® METABASE TIPS

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª:
- **Numbers** ‚Üí Display ‚Üí "Normal"
- **Percentages** ‚Üí Column settings ‚Üí "Percentage"
- **Time** ‚Üí Format ‚Üí "h min s sec"

### –¶–≤–µ—Ç–∞ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤:
- ‚úÖ –£—Å–ø–µ—Ö: –∑–µ–ª—ë–Ω—ã–π (#4CAF50)
- ‚ùå –û—à–∏–±–∫–∏: –∫—Ä–∞—Å–Ω—ã–π (#F44336)
- ‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ: –æ—Ä–∞–Ω–∂–µ–≤—ã–π (#FF9800)
- üìã –û—á–µ—Ä–µ–¥—å: —Å–∏–Ω–∏–π (#2196F3)

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
- **Auto-refresh**: 5 –º–∏–Ω—É—Ç (–¥–ª—è production –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)
- –ò–ª–∏ **manual refresh** —Ç–æ–ª—å–∫–æ

---

## üìÅ –§–ê–ô–õ–´

1. **`schema_extended.sql`** - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ë–î (payments + pricing)
2. **`metabase_queries.sql`** - –≤—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫
3. **`DASHBOARD_README.md`** - —ç—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

---

## ‚ö° –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢

```bash
# 1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –Ω–∞ VPS
scp /tmp/schema_extended.sql root@185.93.108.162:/tmp/
scp /tmp/metabase_queries.sql root@185.93.108.162:/tmp/

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É
ssh root@185.93.108.162 'docker exec neurocards-postgres sh -c "PGPASSWORD=\$POSTGRES_PASSWORD psql -U neurocards -d neurocards < /tmp/schema_extended.sql"'

# 3. –û—Ç–∫—Ä—ã—Ç—å Metabase –∏ —Å–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏
# http://185.93.108.162:3000
```

---

## üîÆ –ö–û–ì–î–ê –î–û–ë–ê–í–Ø–¢–°–Ø –ü–õ–ê–¢–ï–ñ–ò

–î–æ–±–∞–≤–∏–º **–ö–∞—Ä—Ç–æ—á–∫—É 4: –§–∏–Ω–∞–Ω—Å—ã**:

```sql
-- –í—ã—Ä—É—á–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥
SELECT 
  SUM(CASE WHEN completed_at >= NOW() - INTERVAL '7 days' THEN amount_rub END) as "7–¥",
  SUM(CASE WHEN completed_at >= NOW() - INTERVAL '30 days' THEN amount_rub END) as "30–¥"
FROM payments
WHERE status = 'completed';

-- COGS
SELECT 
  COUNT(*) * 0.2 as "COGS_7–¥"
FROM jobs
WHERE status = 'done'
  AND created_at >= NOW() - INTERVAL '7 days';

-- Profit = Revenue - COGS
-- Margin % = Profit / Revenue * 100
```

