services:
  # Telegram Bot (webhook handler)
  - type: web
    name: neurocards-bot
    runtime: python
    plan: starter
    buildCommand: pip install -r requirements.txt
    startCommand: python -m app.main
    envVars:
      - key: BOT_TOKEN
        sync: false
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: PUBLIC_BASE_URL
        sync: false
      - key: WEBHOOK_SECRET_TOKEN
        sync: false
      - key: SUPABASE_BUCKET_INPUTS
        value: inputs
      - key: SUPABASE_BUCKET_OUTPUTS
        value: outputs
      - key: PORT
        value: 10000
    healthCheckPath: /healthz
    
  # Worker (background job processor)
  - type: worker
    name: neurocards-worker
    runtime: python
    plan: starter
    buildCommand: pip install -r requirements.txt
    startCommand: python -m worker.worker
    envVars:
      - key: BOT_TOKEN
        sync: false
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: KIE_API_KEY
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: SUPABASE_BUCKET_INPUTS
        value: inputs
      - key: SUPABASE_BUCKET_OUTPUTS
        value: outputs

