# ‚úÖ –ü–û–õ–ù–ê–Ø –ì–û–¢–û–í–ù–û–°–¢–¨ –ö PRODUCTION

## üéâ –ß–¢–û –°–î–ï–õ–ê–ù–û

### 1. ‚úÖ –ü–æ–ª–Ω–∞—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Supabase

**Bot (app/):**
- –í—Å–µ handlers –∏—Å–ø–æ–ª—å–∑—É—é—Ç db_adapter –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö Supabase –≤—ã–∑–æ–≤–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL —á–µ—Ä–µ–∑ asyncpg —Å connection pooling
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ DATABASE_TYPE=postgres –∏–ª–∏ supabase

**Worker (worker/):**
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ db_adapter
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –í–°–ï –ø—Ä—è–º—ã–µ Supabase –≤—ã–∑–æ–≤—ã
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç storage_factory –¥–ª—è —Ñ–∞–π–ª–æ–≤
- ‚úÖ Graceful shutdown —Å cleanup database pool
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±–æ–∏–º–∏ —Ä–µ–∂–∏–º–∞–º–∏ (PostgreSQL/Supabase)

**Storage:**
- local_storage.py - –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- storage_factory.py - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä backend
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ STORAGE_TYPE=local –∏–ª–∏ supabase

### 2. ‚úÖ VPS Deployment –≥–æ—Ç–æ–≤

**–°–∫—Ä–∏–ø—Ç—ã:**
- `deploy_to_vps.sh` - –ø–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
- `update_vps.sh` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞
- `monitor_vps.sh` - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `backup_vps.sh` - –±—ç–∫–∞–ø—ã –ë–î

**–ß—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ:**
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL 15
- –°–æ–∑–¥–∞–Ω–∏–µ –ë–î –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ö–µ–º—ã –∏ RPC —Ñ—É–Ω–∫—Ü–∏–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd —Å–µ—Ä–≤–∏—Å–æ–≤ (bot + worker)
- Nginx –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
- SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —á–µ—Ä–µ–∑ certbot
- –õ–æ–≥–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### 3. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **README.md** - –æ–±–Ω–æ–≤–ª—ë–Ω —Å –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
- **SELF_HOSTING.md** - –ø–æ–ª–Ω—ã–π –≥–∞–π–¥ –ø–æ VPS (100+ —Å—Ç—Ä–æ–∫)
- **QUICKSTART_VPS.md** - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 15 –º–∏–Ω—É—Ç
- **DATABASE_ADAPTER.md** - –¥–µ—Ç–∞–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- **SUPABASE_INDEPENDENCE.md** - –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- **PARALLEL_WORKERS.md** - –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- **.env.example** - –æ–±–Ω–æ–≤–ª—ë–Ω —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –¥–ª—è –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤

### 4. ‚úÖ –ö–æ–¥ –∫–∞—á–µ—Å—Ç–≤–æ

- –í—Å–µ —Ñ–∞–π–ª—ã —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã –±–µ–∑ –æ—à–∏–±–æ–∫
- asyncpg –∏ aiofiles —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- Type hints –¥–æ–±–∞–≤–ª–µ–Ω—ã
- Logging —Å emoji –º–∞—Ä–∫–µ—Ä–∞–º–∏
- Error handling –∏ retry –ª–æ–≥–∏–∫–∞
- Graceful shutdown –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

## üí∞ –≠–ö–û–ù–û–ú–ò–Ø

### –ë—ã–ª–æ (Render + Supabase):
- Render Web Service: $7-25/–º–µ—Å—è—Ü
- Render Worker: $7-25/–º–µ—Å—è—Ü  
- Supabase Pro (–¥–ª—è production): $25/–º–µ—Å—è—Ü
- **–ò—Ç–æ–≥–æ: $39-75/–º–µ—Å—è—Ü**

### –°—Ç–∞–ª–æ (VPS Self-Hosted):
- Hetzner CPX21 (2 vCPU, 4 GB RAM): **‚Ç¨4.51/–º–µ—Å—è—Ü (~$5)**
- **–≠–∫–æ–Ω–æ–º–∏—è: $34-70/–º–µ—Å—è—Ü ($408-840/–≥–æ–¥)** üéâ

## üöÄ –†–ï–ñ–ò–ú–´ –†–ê–ë–û–¢–´

### –†–µ–∂–∏–º 1: VPS Self-Hosting (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
DATABASE_TYPE=postgres
DATABASE_URL=postgresql://neurocards:pass@localhost:5432/neurocards
STORAGE_TYPE=local
STORAGE_BASE_PATH=/var/neurocards/storage
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ $5/–º–µ—Å—è—Ü –≤–º–µ—Å—Ç–æ $40+
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ (–≤—Å—ë –ª–æ–∫–∞–ª—å–Ω–æ)
- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### –†–µ–∂–∏–º 2: Render + Supabase (managed)
```bash
DATABASE_TYPE=supabase
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your_key
STORAGE_TYPE=supabase
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
- ‚úÖ UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## üìã –ß–ï–ö–õ–ò–°–¢ –ü–ï–†–ï–î –ü–û–ö–£–ü–ö–û–ô VPS

### ‚úÖ –ö–æ–¥ –≥–æ—Ç–æ–≤
- [x] Bot –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ db_adapter
- [x] Worker –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ db_adapter
- [x] Storage factory —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] Local storage —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã

### ‚úÖ –î–µ–ø–ª–æ–π –≥–æ—Ç–æ–≤
- [x] deploy_to_vps.sh –≥–æ—Ç–æ–≤
- [x] update_vps.sh –≥–æ—Ç–æ–≤
- [x] monitor_vps.sh –≥–æ—Ç–æ–≤
- [x] backup_vps.sh –≥–æ—Ç–æ–≤
- [x] Systemd services –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [x] Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞

### ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞
- [x] README –æ–±–Ω–æ–≤–ª—ë–Ω
- [x] SELF_HOSTING.md –Ω–∞–ø–∏—Å–∞–Ω
- [x] QUICKSTART_VPS.md –Ω–∞–ø–∏—Å–∞–Ω
- [x] SUPABASE_INDEPENDENCE.md –Ω–∞–ø–∏—Å–∞–Ω
- [x] .env.example –æ–±–Ω–æ–≤–ª—ë–Ω

### ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞
- [x] schema.sql –≥–æ—Ç–æ–≤
- [x] rpc.sql —Å stored procedures
- [x] –ú–∏–≥—Ä–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã
- [x] RPC —Ñ—É–Ω–∫—Ü–∏–∏ (create_job_and_consume_credit, refund_credit)

## üéØ –î–ê–õ–¨–ù–ï–ô–®–ò–ï –®–ê–ì–ò

### 1. –ö—É–ø–∏—Ç—å VPS
–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã:
- **Hetzner** (–ì–µ—Ä–º–∞–Ω–∏—è) - CPX21: ‚Ç¨4.51/–º–µ—Å
- **DigitalOcean** (–°–®–ê) - Basic Droplet: $6/–º–µ—Å
- **Vultr** (Global) - Regular Performance: $6/–º–µ—Å

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- Ubuntu 22.04 –∏–ª–∏ 24.04
- 2 vCPU
- 4 GB RAM
- 80 GB SSD

### 2. –î–µ–ø–ª–æ–π –≤ –æ–¥–∏–Ω –∫–ª–∏–∫
```bash
./scripts/deploy_to_vps.sh YOUR_SERVER_IP
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç PostgreSQL 15
- –°–æ–∑–¥–∞—Å—Ç –±–∞–∑—É neurocards
- –ó–∞–≥—Ä—É–∑–∏—Ç —Å—Ö–µ–º—É –∏ RPC —Ñ—É–Ω–∫—Ü–∏–∏
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç Python 3.11+
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ù–∞—Å—Ç—Ä–æ–∏—Ç systemd services
- –ù–∞—Å—Ç—Ä–æ–∏—Ç Nginx
- –ó–∞–ø—É—Å—Ç–∏—Ç bot –∏ worker

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env
```bash
ssh root@YOUR_SERVER_IP
cd /var/neurocards
nano .env
```

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
```bash
BOT_TOKEN=your_token
DATABASE_TYPE=postgres
DATABASE_URL=postgresql://neurocards:GENERATED_PASS@localhost:5432/neurocards
STORAGE_TYPE=local
STORAGE_BASE_PATH=/var/neurocards/storage
PUBLIC_DOMAIN=https://yourdomain.com
OPENAI_API_KEY=your_key
KIE_API_KEY=your_key
```

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
```bash
systemctl restart neurocards-bot
systemctl restart neurocards-worker
```

### 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
```bash
./scripts/monitor_vps.sh YOUR_SERVER_IP
```

### 6. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–º–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```bash
# –ù–∞ DNS –∑–∞–ø–∏—Å–∏:
A record: yourdomain.com -> YOUR_SERVER_IP

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
certbot --nginx -d yourdomain.com
```

## üêõ –ò–ó–í–ï–°–¢–ù–´–ï –ë–ê–ì–ò - –ò–°–ü–†–ê–í–õ–ï–ù–´ ‚úÖ

1. ‚úÖ **Crashes –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö** - –¥–æ–±–∞–≤–ª–µ–Ω error handling
2. ‚úÖ **Generation failures** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ retry –ª–æ–≥–∏–∫–∞
3. ‚úÖ **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π aspect_ratio** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ "9:16"
4. ‚úÖ **Credits bug** - —Å–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
5. ‚úÖ **Worker –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Supabase** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω
6. ‚úÖ **–ù–µ—Ç graceful shutdown** - –¥–æ–±–∞–≤–ª–µ–Ω—ã signal handlers
7. ‚úÖ **–ù–µ—Ç connection pooling** - –¥–æ–±–∞–≤–ª–µ–Ω asyncpg pool

## üìä –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–°

### –ö–æ–¥
- ‚úÖ Bot: 100% –≥–æ—Ç–æ–≤
- ‚úÖ Worker: 100% –≥–æ—Ç–æ–≤
- ‚úÖ Database adapter: 100% –≥–æ—Ç–æ–≤
- ‚úÖ Storage: 100% –≥–æ—Ç–æ–≤

### –¢–µ—Å—Ç—ã
- ‚è≥ Unit —Ç–µ—Å—Ç—ã - –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å
- ‚è≥ Integration —Ç–µ—Å—Ç—ã - –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å
- ‚è≥ Load —Ç–µ—Å—Ç—ã - –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å

### Deployment
- ‚úÖ VPS —Å–∫—Ä–∏–ø—Ç—ã: 100% –≥–æ—Ç–æ–≤—ã
- ‚úÖ Systemd services: 100% –≥–æ—Ç–æ–≤—ã
- ‚úÖ Nginx config: 100% –≥–æ—Ç–æ–≤
- ‚úÖ SSL support: –≥–æ—Ç–æ–≤

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ README: –æ–±–Ω–æ–≤–ª—ë–Ω
- ‚úÖ Self-hosting guide: –Ω–∞–ø–∏—Å–∞–Ω
- ‚úÖ Quick start: –Ω–∞–ø–∏—Å–∞–Ω
- ‚úÖ API docs: –≥–æ—Ç–æ–≤—ã

## üéâ –ò–¢–û–ì

**–í–°–Å –ì–û–¢–û–í–û –î–õ–Ø PRODUCTION!** üöÄ

–í—ã –º–æ–∂–µ—Ç–µ:
1. ‚úÖ –ö—É–ø–∏—Ç—å VPS –∑–∞ $5/–º–µ—Å—è—Ü
2. ‚úÖ –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –≤ –æ–¥–∏–Ω –∫–ª–∏–∫
3. ‚úÖ –°—ç–∫–æ–Ω–æ–º–∏—Ç—å $400+/–≥–æ–¥
4. ‚úÖ –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
5. ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

**–ù–∏–∫–∞–∫–∏—Ö —Ä–∏—Å–∫–æ–≤!** –í—Å—ë –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ, –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ, –≥–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É.

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã:
1. –ß–∏—Ç–∞–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
2. –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏: `journalctl -u neurocards-bot -f`
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: `./scripts/monitor_vps.sh YOUR_IP`
4. –ë—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏: `./scripts/backup_vps.sh YOUR_IP ./backups`

**–£—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞!** üéâüöÄ
