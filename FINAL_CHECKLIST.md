# üöÄ FINAL DEPLOYMENT CHECKLIST

**–î–∞—Ç–∞:** 2026-01-22 19:30 UTC  
**–°—Ç–∞—Ç—É—Å:** 95% –≥–æ—Ç–æ–≤–æ, –æ—Å—Ç–∞–ª–æ—Å—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å KIE –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

---

## ‚úÖ **–ß–¢–û –¢–û–ß–ù–û –†–ê–ë–û–¢–ê–ï–¢ (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ):**

1. ‚úÖ **20 worker'–æ–≤ –∑–∞–ø—É—â–µ–Ω—ã** –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ
2. ‚úÖ **PostgreSQL** –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. ‚úÖ **Database migration** –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ (tg_user_id –≤ jobs)
4. ‚úÖ **Worker –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç job'—ã** –∏–∑ –æ—á–µ—Ä–µ–¥–∏ (FOR UPDATE SKIP LOCKED)
5. ‚úÖ **JSON parsing** –¥–ª—è product_info –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
6. ‚úÖ **–§—É–Ω–∫—Ü–∏—è update_job** –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ (NOW() —Ä–∞–±–æ—Ç–∞–µ—Ç)
7. ‚úÖ **–ü—Ä–æ–º–ø—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (GPT –∏ direct)
8. ‚úÖ **KieKeyRotator** –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
9. ‚úÖ **102 –∫—Ä–µ–¥–∏—Ç–∞** –Ω–∞—á–∏—Å–ª–µ–Ω—ã —Ç–µ–±–µ (tg_id: 5235703016)
10. ‚úÖ **Retry –ª–æ–≥–∏–∫–∞** –Ω–∞–ø–∏—Å–∞–Ω–∞ –∏ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–∞
11. ‚úÖ **Error classifier** –Ω–∞–ø–∏—Å–∞–Ω –∏ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç
12. ‚úÖ **Systemd —Å–µ—Ä–≤–∏—Å—ã** –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
13. ‚úÖ **Management scripts** —Å–æ–∑–¥–∞–Ω—ã

---

## ‚ö†Ô∏è **–ß–¢–û –ù–£–ñ–ù–û –î–û–î–ï–õ–ê–¢–¨:**

###  1. **KIE API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (10 –º–∏–Ω—É—Ç —Å —Ä–∞–±–æ—á–∏–º –∫–ª—é—á–æ–º)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–ª—é—á `dcf5ae0bd4cf7736f0dbcd5337c0d9fd` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401

**–ù—É–∂–Ω–æ:**
- –†–∞–±–æ—á–∏–π KIE API –∫–ª—é—á
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ URL (api.kie.ai –∏–ª–∏ –¥—Ä—É–≥–æ–π?)
- –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ (–≤–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω—ã –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã?)

**–§–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```bash
/var/neurocards/neurocards-bot/worker/kie_client.py  # KIE API –∫–ª–∏–µ–Ω—Ç
/var/neurocards/neurocards-bot/.env                  # KIE_API_KEY
```

###  2. **HTTPS Webhook** (15 –º–∏–Ω—É—Ç)

**–ü—Ä–æ–±–ª–µ–º–∞:** Telegram —Ç—Ä–µ–±—É–µ—Ç HTTPS, —Å–µ–π—á–∞—Å HTTP

**–†–µ—à–µ–Ω–∏–µ A - Ngrok (–¥–ª—è —Ç–µ—Å—Ç–∞):**
```bash
# –ù–∞ VPS
wget https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-amd64.tgz
tar xvzf ngrok-v3-stable-linux-amd64.tgz
mv ngrok /usr/local/bin/
ngrok http 10000  # –ü–æ–ª—É—á–∏—à—å https://xxx.ngrok-free.app

# –û–±–Ω–æ–≤–∏—Ç—å .env
nano /var/neurocards/neurocards-bot/.env
PUBLIC_BASE_URL=https://xxx.ngrok-free.app

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
systemctl restart neurocards-bot
```

**–†–µ—à–µ–Ω–∏–µ B - Nginx + Let's Encrypt (–ø—Ä–æ–¥–∞–∫—à–Ω):**
```bash
# –ù—É–∂–µ–Ω –¥–æ–º–µ–Ω, –Ω–∞–ø—Ä–∏–º–µ—Ä neurocards.yourdomain.com
apt install nginx certbot python3-certbot-nginx
certbot --nginx -d neurocards.yourdomain.com
```

###  3. **End-to-end —Ç–µ—Å—Ç** (–ø–æ—Å–ª–µ –ø.1 –∏ –ø.2)

1. –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞ –≤ Telegram
2. /start ‚Üí "–°–¥–µ–ª–∞—Ç—å Reels"
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ
4. –ü—Ä–æ–π—Ç–∏ —Ñ–ª–æ—É
5. –î–æ–∂–¥–∞—Ç—å—Å—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (5-30 –º–∏–Ω)

---

## üêõ **–ò–ó–í–ï–°–¢–ù–´–ï –ë–ê–ì–ò (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–æ –Ω–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã):**

### –î—É–±–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (8 —Å–æ–æ–±—â–µ–Ω–∏–π)
**–ü—Ä–∏—á–∏–Ω–∞:** Worker'—ã –ø–∞–¥–∞–ª–∏ –Ω–∞ –æ—à–∏–±–∫–∞—Ö ‚Üí retry ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–ª –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—é –Ω–∞ –∫–∞–∂–¥—É—é –ø–æ–ø—ã—Ç–∫—É

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- –§–∏–∫—Å JSON parsing
- –§–∏–∫—Å update_job
- –¢–µ–ø–µ—Ä—å –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥—É–±–ª–µ–π

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ 1 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

---

## üìù **–ö–û–ú–ê–ù–î–´ –î–õ–Ø –ü–†–û–í–ï–†–ö–ò:**

### Worker'—ã
```bash
ssh root@185.93.108.162

# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö worker'–æ–≤
systemctl status 'neurocards-worker@*' | grep Active | wc -l
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: 20

# –õ–æ–≥–∏
tail -f /var/log/syslog | grep neurocards-worker

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
systemctl restart 'neurocards-worker@*'
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```bash
# –¢–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç
sudo -u postgres psql -d neurocards -c "SELECT * FROM users WHERE tg_user_id=5235703016;"

# –û—á–µ—Ä–µ–¥—å
sudo -u postgres psql -d neurocards -c "SELECT status, COUNT(*) FROM jobs GROUP BY status;"

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ job'—ã
sudo -u postgres psql -d neurocards -c "SELECT id::text, status, error FROM jobs WHERE tg_user_id=5235703016 ORDER BY created_at DESC LIMIT 5;"
```

### –ë–æ—Ç
```bash
# –°—Ç–∞—Ç—É—Å
systemctl status neurocards-bot

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
systemctl restart neurocards-bot

# –õ–æ–≥–∏
tail -f /var/log/syslog | grep neurocards-bot
```

---

## üß™ **–¢–ï–°–¢–û–í–´–ï –°–¶–ï–ù–ê–†–ò–ò:**

### –¢–µ—Å—Ç 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 1 –≤–∏–¥–µ–æ (UGC —à–∞–±–ª–æ–Ω)
```
1. /start
2. "–°–¥–µ–ª–∞—Ç—å Reels"
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞
4. "–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä"
5. "UGC –ë–ª–æ–≥–µ—Ä"
6. "-" (–Ω–µ—Ç –ø–æ–∂–µ–ª–∞–Ω–∏–π)
7. "1 –≤–∏–¥–µ–æ"
8. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å

–û–∂–∏–¥–∞–µ—Ç—Å—è:
- 1 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞"
- –ß–µ—Ä–µ–∑ 5-30 –º–∏–Ω –ø–æ–ª—É—á–∏—Ç—å –≤–∏–¥–µ–æ
- –ö—Ä–µ–¥–∏—Ç—ã: 102 ‚Üí 101
```

### –¢–µ—Å—Ç 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 3 –≤–∏–¥–µ–æ
```
–¢–æ—Ç –∂–µ —Ñ–ª–æ—É, –Ω–æ –≤—ã–±—Ä–∞—Ç—å "3 –≤–∏–¥–µ–æ"

–û–∂–∏–¥–∞–µ—Ç—Å—è:
- 1 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è 3 –≤–∏–¥–µ–æ –∑–∞–ø—É—â–µ–Ω–∞"
- –ü–æ–ª—É—á–∏—Ç—å 3 –≤–∏–¥–µ–æ –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ –º–µ—Ä–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- –ö—Ä–µ–¥–∏—Ç—ã: 101 ‚Üí 98
```

### –¢–µ—Å—Ç 3: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–µ–¥–∏—Ç–æ–≤
```
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ –∫—Ä–µ–¥–∏—Ç—ã ‚Üí –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞—Ç—å –µ—â—ë

–û–∂–∏–¥–∞–µ—Ç—Å—è:
- –°–æ–æ–±—â–µ–Ω–∏–µ "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–µ–¥–∏—Ç–æ–≤"
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å"
```

### –¢–µ—Å—Ç 4: User Violation (–ø–ª–æ—Ö–æ–µ —Ñ–æ—Ç–æ)
```
–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ —Å —á–µ–ª–æ–≤–µ–∫–æ–º –∏–ª–∏ NSFW

–û–∂–∏–¥–∞–µ—Ç—Å—è:
- "–í—ã –Ω–∞—Ä—É—à–∏–ª–∏ –ø—Ä–∞–≤–∏–ª–∞ SORA 2"
- –ö—Ä–µ–¥–∏—Ç –≤–µ—Ä–Ω—É–ª—Å—è
```

---

## üìä **CAPACITY PLANNING:**

### –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- **Workers:** 20
- **Throughput:** ~4,800 videos/day
- **Peak capacity:** 400 videos per 2 hours

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# –î–æ–±–∞–≤–∏—Ç—å –¥–æ 50 worker'–æ–≤
for i in {21..50}; do
  systemctl enable neurocards-worker@$i
  systemctl start neurocards-worker@$i
done

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
systemctl is-active 'neurocards-worker@*' | grep -c active
```

---

## üîë **API KEYS:**

### Telegram Bot
```
BOT_TOKEN=<–≤–∞—à_—Ç–æ–∫–µ–Ω>  # –í .env
```

### OpenAI (–¥–ª—è GPT –ø—Ä–æ–º–ø—Ç–æ–≤)
```
OPENAI_API_KEY=sk-proj-...  # EXPIRED –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π
```
‚ö†Ô∏è **–ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å** –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ UGC/Ad —à–∞–±–ª–æ–Ω—ã

### KIE AI
```
KIE_API_KEY=dcf5ae0bd4cf7736f0dbcd5337c0d9fd  # –ù–ï –†–ê–ë–û–¢–ê–ï–¢
```
‚ö†Ô∏è **–ù—É–∂–µ–Ω —Ä–∞–±–æ—á–∏–π –∫–ª—é—á!**

---

## üìö **–î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø:**

–í—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
- `FULL_FLOW_DOCUMENTATION.md` - –ø–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ (638 —Å—Ç—Ä–æ–∫)
- `DEPLOYMENT_REPORT.md` - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –æ—Ç—á—ë—Ç
- `SCALING_GUIDE.md` - –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- `FIXES.md` - —á–µ–∫–ª–∏—Å—Ç –¥–æ—Ä–∞–±–æ—Ç–æ–∫

---

## üéØ **–ß–¢–û –°–î–ï–õ–ê–¢–¨ –°–ï–ô–ß–ê–°:**

1. **–ü–æ–ª—É—á–∏—Ç—å —Ä–∞–±–æ—á–∏–π KIE API –∫–ª—é—á**
   - –ó–∞–π—Ç–∏ –Ω–∞ kie.ai
   - –°–æ–∑–¥–∞—Ç—å/–Ω–∞–π—Ç–∏ –∫–ª—é—á
   - –û–±–Ω–æ–≤–∏—Ç—å –≤ `.env`

2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å HTTPS webhook**
   - Ngrok –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∞
   - –ò–õ–ò Nginx + –¥–æ–º–µ–Ω –¥–ª—è –ø—Ä–æ–¥–∞

3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å end-to-end —Ç–µ—Å—Ç**
   - –ü—Ä–æ–π—Ç–∏ —Ñ–ª–æ—É –≤ Telegram
   - –î–æ–∂–¥–∞—Ç—å—Å—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## ‚úÖ **–ü–û–°–õ–ï –£–°–ü–ï–®–ù–û–ì–û –¢–ï–°–¢–ê:**

- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –∞–¥–º–∏–Ω—É (billing errors)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Grafana?)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ KIE –∫–ª—é—á–µ–π –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
- [ ] –ì–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É! üöÄ

---

**–ò—Ç–æ–≥:** –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –Ω–∞ 95%. –û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å KIE –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Ä–∞–±–æ—á–∏–º –∫–ª—é—á–æ–º –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å HTTPS webhook.

**–í—Ä–µ–º—è –¥–æ –ø–æ–ª–Ω–æ–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** 30 –º–∏–Ω—É—Ç (—Å —Ä–∞–±–æ—á–∏–º KIE –∫–ª—é—á–æ–º)
