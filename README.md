# Neurocards Bot

Telegram-–±–æ—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö –≤–∏–¥–µ–æ (Reels/TikTok) –∏–∑ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–æ–≤ —Å –ø–æ–º–æ—â—å—é AI.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üì∏ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ –∏–∑ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞
- üé¨ –ù–µ—Å–∫–æ–ª—å–∫–æ —à–∞–±–ª–æ–Ω–æ–≤ (UGC –±–ª–æ–≥–µ—Ä, —Ä–µ–∫–ª–∞–º–∞, –∫—Ä–µ–∞—Ç–∏–≤)
- ü§ñ AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ —á–µ—Ä–µ–∑ OpenAI GPT
- üé• –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ KIE.AI (Sora-2)
- üí≥ –°–∏—Å—Ç–µ–º–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤ –∏ –±–∞–ª–∞–Ω—Å–æ–≤
- üîÑ –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –¥—É–±–ª–µ–π
- üìä –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:

1. **Bot (Web Service)** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ webhook –æ—Ç Telegram
2. **Worker (Background)** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—á–µ—Ä–µ–¥–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Python 3.11+**
- **aiogram 3** - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Telegram –±–æ—Ç–æ–≤
- **PostgreSQL** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Supabase –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–∞—è)
- **asyncpg** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä PostgreSQL
- **KIE.AI API** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ (Sora-2 image-to-video)
- **OpenAI API** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ (GPT-4)
- **httpx** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# Telegram
BOT_TOKEN=your_telegram_bot_token
WEBHOOK_SECRET_TOKEN=random_secret_string

# Database (–≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)
# –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω–∞—è PostgreSQL (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è VPS)
DATABASE_TYPE=postgres
DATABASE_URL=postgresql://user:password@localhost:5432/neurocards

# –í–∞—Ä–∏–∞–Ω—Ç 2: Supabase (managed)
DATABASE_TYPE=supabase
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Webhook URL (–¥–ª—è production)
PUBLIC_BASE_URL=https://your-bot.onrender.com

# AI APIs
KIE_API_KEY=your_kie_api_key
OPENAI_API_KEY=your_openai_api_key
```

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–º. –≤ [.env.example](.env.example)

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **2 —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã —Å –ë–î** (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `DATABASE_TYPE`):

### –†–µ–∂–∏–º 1: –õ–æ–∫–∞–ª—å–Ω–∞—è PostgreSQL (–¥–ª—è self-hosting)

```bash
# .env
DATABASE_TYPE=postgres
DATABASE_URL=postgresql://botuser:password@localhost:5432/neurocards

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º deploy_to_vps.sh
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü–æ–ª–Ω–∞—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ (–Ω–µ—Ç —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫)
- ‚úÖ –î–µ—à–µ–≤–ª–µ (–Ω–µ –ø–ª–∞—Ç–∏—à—å –∑–∞ managed –ë–î)

### –†–µ–∂–∏–º 2: Supabase (managed)

```bash
# .env
DATABASE_TYPE=supabase  # –∏–ª–∏ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å PostgreSQL
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
- ‚úÖ Web UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ú–∏–≥—Ä–∞—Ü–∏–∏

–ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `supabase/schema.sql`.

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π PostgreSQL:
```bash
psql -d neurocards -f supabase/schema.sql
```

–î–ª—è Supabase: –≤—ã–ø–æ–ª–Ω–∏ SQL –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ `supabase/migrations/` –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:

1. `20240722120000_atomicity_and_idempotency.sql` - –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –∏ idempotency
2. `20240723120000_add_unique_index_on_tg_user_id.sql` - –∏–Ω–¥–µ–∫—Å—ã

### Storage Buckets

–°–æ–∑–¥–∞–π—Ç–µ –≤ Supabase Storage:
- `inputs` - –¥–ª—è –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–æ—Ç–æ
- `outputs` - –¥–ª—è –≥–æ—Ç–æ–≤—ã—Ö –≤–∏–¥–µ–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üöÄ –î–µ–ø–ª–æ–π

### üè† Self-Hosted VPS (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è - —ç–∫–æ–Ω–æ–º–∏—è ~$20/–º–µ—Å)

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –≤ –æ–¥–∏–Ω –∫–ª–∏–∫:**

```bash
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞ —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä (Hetzner, DigitalOcean, Vultr –∏ —Ç.–¥.)
./scripts/deploy_to_vps.sh YOUR_SERVER_IP
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞:**
```bash
./scripts/update_vps.sh YOUR_SERVER_IP
```

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
```bash
./scripts/monitor_vps.sh YOUR_SERVER_IP
```

**–ë—ç–∫–∞–ø:**
```bash
./scripts/backup_vps.sh YOUR_SERVER_IP ./backups
```

–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: [SELF_HOSTING.md](SELF_HOSTING.md)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–µ—Ä–≤–µ—Ä–æ–º
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è $20-25/–º–µ—Å (VPS ~$5 –≤–º–µ—Å—Ç–æ $25+)
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ (–≤—Å–µ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ)
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å (–∑–∞–ø—É—Å–∫–∞–π —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ worker'–æ–≤)

---

### ‚òÅÔ∏è Render.com + Supabase (managed)

1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫ Render
2. Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏—Ç `render.yaml`
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
4. Deploy!

–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: [DEPLOYMENT.md](DEPLOYMENT.md)

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –î–æ—Ä–æ–∂–µ (~$25-30/–º–µ—Å)
- ‚ö†Ô∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ª–∏–º–∏—Ç–æ–≤ Supabase/Render
- ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–µ–µ (—Å–µ—Ç—å –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏)

---

### üíª –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ (–≤ –æ–¥–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
python -m app.main

# –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–∞ (–≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
python -m worker.worker
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check

```bash
curl https://your-bot-url.onrender.com/healthz
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: ok
```

### –õ–æ–≥–∏

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç:
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- ‚ùå –û—à–∏–±–∫–∏
- üöÄ –°—Ç–∞—Ä—Ç/–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

## üêõ Troubleshooting

### –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `BOT_TOKEN` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `PUBLIC_BASE_URL` –¥–æ—Å—Ç—É–ø–µ–Ω

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Worker –∑–∞–ø—É—â–µ–Ω
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `KIE_API_KEY` –∏ `OPENAI_API_KEY` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å API –∫–ª—é—á–µ–π
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ Worker'–∞

### –í–∏–¥–µ–æ –ø–æ–ª—É—á–∞—é—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

- aspect_ratio –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ `9:16` –¥–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–µ–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –∫–æ–¥–∞

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π: [FIXES.md](FIXES.md)

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [DEPLOYMENT.md](DEPLOYMENT.md) - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é
- [FIXES.md](FIXES.md) - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∏ —É–ª—É—á—à–µ–Ω–∏–π
- [.env.example](.env.example) - —à–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `WEBHOOK_SECRET_TOKEN` –¥–ª—è –∑–∞—â–∏—Ç—ã webhook
- `SUPABASE_SERVICE_ROLE_KEY` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–µ–∫—Ä–µ—Ç–µ
- –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ API –∫–ª—é—á–∏

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [FIXES.md](FIXES.md) –∏ [DEPLOYMENT.md](DEPLOYMENT.md)
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ Render Dashboard
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `jobs` –≤ Supabase –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
