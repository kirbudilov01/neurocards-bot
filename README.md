# Neurocards Bot

Telegram-ะฑะพั ะดะปั ะผะฐััะพะฒะพะน ะณะตะฝะตัะฐัะธะธ ะฒะตััะธะบะฐะปัะฝัั ะฒะธะดะตะพ (Reels/TikTok/Shorts) ะธะท ัะพัะพ ัะพะฒะฐัะพะฒ ัะตัะตะท AI.

## ๐ ะะพะทะผะพะถะฝะพััะธ

- ๐ธ ะะตะฝะตัะฐัะธั AI-ะฒะธะดะตะพ ะธะท ัะพัะพ ัะพะฒะฐัะฐ
- โก **ะะฐััะพะฒะฐั ะฟะฐัะฐะปะปะตะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ** (ัััััะธ ะฒะธะดะตะพ ะฒ ะดะตะฝั)
- ๐ **ะะฒัะพะผะฐัะธัะตัะบะฐั ัะพัะฐัะธั API ะบะปััะตะน** (ะทะฐัะธัะฐ ะพั rate limits)
- ๐ฌ ะะตัะบะพะปัะบะพ ัะฐะฑะปะพะฝะพะฒ (UGC ะฑะปะพะณะตั, ัะตะบะปะฐะผะฐ, ะบัะตะฐัะธะฒ)
- ๐ค AI-ะณะตะฝะตัะฐัะธั ะฟัะพะผะฟัะพะฒ ัะตัะตะท OpenAI GPT-4
- ๐ฅ ะะตะฝะตัะฐัะธั ะฒะธะดะตะพ ัะตัะตะท KIE.AI (Sora-2 image-to-video)
- ๐ณ ะกะธััะตะผะฐ ะบัะตะดะธัะพะฒ ะธ ะฑะฐะปะฐะฝัะพะฒ
- ๐ ะะธัะฝัะน ะบะฐะฑะธะฝะตั ะฟะพะปัะทะพะฒะฐัะตะปั
- ๐ณ **Docker-ready** ั ะฐะฒัะพะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะตะผ

---

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ
โ   Telegram      โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
    โโโโโโผโโโโโ
    โ   Bot   โ (Webhook Handler)
    โโโโโโฌโโโโโ
         โ ัะพะทะดะฐะตั ะทะฐะดะฐัั
         โผ
    โโโโโโโโโโโ
    โ  Redis  โ (ะัะตัะตะดั ะทะฐะดะฐั)
    โโโโโโฌโโโโโ
         โ ัะฐัะฟัะตะดะตะปัะตั
         โโโโโโโโฌโโโโโโโฌโโโโโโโ
         โผ      โผ      โผ      โผ
    โโโโโโโโโโ โโโโโโโโโโ โโโโโโโโโโ
    โWorker 1โ โWorker 2โ โWorker Nโ (ะะฐัะฐะปะปะตะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ)
    โโโโโโฌโโโโ โโโโโโฌโโโโ โโโโโโฌโโโโ
         โ          โ          โ
         โโโโโโโโฌโโโโดโโโโโโโโโโโ
                โผ
        โโโโโโโโโโโโโโโโโ
        โ   KIE.AI API  โ (ะะตะฝะตัะฐัะธั ะฒะธะดะตะพ)
        โโโโโโโโโโโโโโโโโ
                โ
                โผ (ั ัะพัะฐัะธะตะน ะบะปััะตะน)
            ๐น ะะพัะพะฒะพะต ะฒะธะดะตะพ
                โ
                โผ
            Telegram
```

### ะะพะผะฟะพะฝะตะฝัั:

1. **Bot** - ะพะฑัะฐะฑะพััะธะบ webhook ะพั Telegram
2. **Redis** - ะพัะตัะตะดั ะทะฐะดะฐั ั ะฐะฒัะพะผะฐัะธัะตัะบะธะผ ัะฐัะฟัะตะดะตะปะตะฝะธะตะผ
3. **Workers** - ะฟะฐัะฐะปะปะตะปัะฝัะต ะพะฑัะฐะฑะพััะธะบะธ (ะปะตะณะบะพ ะผะฐัััะฐะฑะธัััััั)
4. **PostgreSQL** - ััะฐะฝะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปะตะน, ะฑะฐะปะฐะฝัะพะฒ, ะธััะพัะธะธ
5. **Storage** - ะปะพะบะฐะปัะฝะพะต ััะฐะฝะธะปะธัะต ัะฐะนะปะพะฒ

---

## ๐ฅ ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต

### ะะฐัะฐะปะปะตะปัะฝัะต ะฒะพัะบะตัั

```bash
# ะะฐะฟัััะธัั 10 ะฒะพัะบะตัะพะฒ ะพะดะฝะพะฒัะตะผะตะฝะฝะพ
docker-compose up --scale worker=10

# ะะปะธ ะฒ .env ัััะฐะฝะพะฒะธัั
WORKER_REPLICAS=10
```

### ะะพัะฐัะธั API ะบะปััะตะน

ะะฐัะธัะฐ ะพั rate limits ัะตัะตะท ะฐะฒัะพะผะฐัะธัะตัะบัั ัะพัะฐัะธั:

```env
# ะะตัะบะพะปัะบะพ ะบะปััะตะน ัะตัะตะท ะทะฐะฟัััั
KIE_API_KEY=key1,key2,key3,key4,key5

# ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ:
# - ะะฐัะฟัะตะดะตะปัะตั ะฝะฐะณััะทะบั (round-robin)
# - ะะปะพะบะธััะตั ะบะปััะธ ะฟัะธ rate limit
# - ะะตัะตะบะปััะฐะตััั ะฝะฐ ะทะดะพัะพะฒัะต ะบะปััะธ
```

---

## ๐ ะัััััะน ััะฐัั

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั

```bash
git clone https://github.com/kirbudilov01/neurocards-bot.git
cd neurocards-bot
```

### 2. ะะฐัััะพะนะบะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั

```bash
cp .env.docker .env
nano .env
```

ะะธะฝะธะผะฐะปัะฝัะต ะฝะฐัััะพะนะบะธ:

```env
# Telegram
BOT_TOKEN=your_bot_token
WEBHOOK_SECRET_TOKEN=random_secret_string
PUBLIC_BASE_URL=https://your-domain.com

# Database
POSTGRES_PASSWORD=secure_password_here

# AI APIs (ะฝะตัะบะพะปัะบะพ ะบะปััะตะน ัะตัะตะท ะทะฐะฟัััั!)
KIE_API_KEY=key1,key2,key3
OPENAI_API_KEY=your_openai_key

# ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต
WORKER_REPLICAS=5  # ะะพะปะธัะตััะฒะพ ะฒะพัะบะตัะพะฒ
```

### 3. ะะฐะฟััะบ

```bash
# ะกะพะฑัะฐัั ะธ ะทะฐะฟัััะธัั ะฒัะต ัะตัะฒะธัั
docker-compose up -d

# ะัะพะฒะตัะธัั ะปะพะณะธ
docker-compose logs -f

# ะัะพะฒะตัะธัั ััะฐััั
docker-compose ps
```

### 4. ะัะพะฒะตัะบะฐ ัะฐะฑะพัะพัะฟะพัะพะฑะฝะพััะธ

```bash
# Health check
curl http://localhost:8080/healthz

# ะะพะณะธ ะฑะพัะฐ
docker-compose logs bot

# ะะพะณะธ ะฒะพัะบะตัะพะฒ
docker-compose logs worker
```

---

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ะกัะฐัะธััะธะบะฐ ะพัะตัะตะดะธ

```bash
# ะะพะดะบะปััะธัััั ะบ ะบะพะฝัะตะนะฝะตัั ะฑะพัะฐ
docker-compose exec bot python -c "
from app.services.redis_queue import get_queue_stats
print(get_queue_stats())
"
```

### ะะพะณะธ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ

```bash
# ะัะต ัะตัะฒะธัั
docker-compose logs -f

# ะขะพะปัะบะพ ะฒะพัะบะตัั
docker-compose logs -f worker

# ะขะพะปัะบะพ Redis
docker-compose logs -f redis
```

### ะะตััะธะบะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

```bash
# ะะพะปะธัะตััะฒะพ ะทะฐะดะฐั ะฒ ะพัะตัะตะดะธ
docker-compose exec redis redis-cli LLEN rq:queue:neurocards

# ะกัะฐัะธััะธะบะฐ ะฒะพัะบะตัะพะฒ
docker-compose exec redis redis-cli KEYS rq:worker:*
```

---

## โ๏ธ ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต ะฝะฐ production

### ะะปั ะพะฑัะฐะฑะพัะบะธ ััััั ะฒะธะดะตะพ ะฒ ะดะตะฝั:

1. **ะฃะฒะตะปะธัััะต ะบะพะปะธัะตััะฒะพ ะฒะพัะบะตัะพะฒ:**
   ```bash
   docker-compose up --scale worker=20 -d
   ```

2. **ะะพะฑะฐะฒััะต ะฑะพะปััะต API ะบะปััะตะน:**
   ```env
   KIE_API_KEY=key1,key2,key3,key4,key5,key6,key7,key8,key9,key10
   ```

3. **ะฃะฒะตะปะธัััะต ัะตััััั PostgreSQL:**
   ```yaml
   # ะ docker-compose.yml
   postgres:
     deploy:
       resources:
         limits:
           memory: 4G
   ```

4. **ะะฐัััะพะนัะต Redis ะดะปั production:**
   ```yaml
   redis:
     command: redis-server --maxmemory 2gb --maxmemory-policy allkeys-lru
   ```

---

## ๐๏ธ ะขะตัะฝะธัะตัะบะฐั ัะฟะตัะธัะธะบะฐัะธั

### ะกัะตะบ ัะตัะฝะพะปะพะณะธะน

- **Python 3.11+**
- **aiogram 3** - Telegram Bot framework
- **Redis + RQ** - ะพัะตัะตะดั ะทะฐะดะฐั
- **PostgreSQL 15** - ะพัะฝะพะฒะฝะฐั ะะ
- **Docker + Docker Compose** - ะบะพะฝัะตะนะฝะตัะธะทะฐัะธั
- **KIE.AI (Sora-2)** - ะณะตะฝะตัะฐัะธั ะฒะธะดะตะพ
- **OpenAI GPT-4 mini** - ะณะตะฝะตัะฐัะธั ะฟัะพะผะฟัะพะฒ

### ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

- โก **ะะฐัะฐะปะปะตะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ:** ะดะพ 100+ ะฒะพัะบะตัะพะฒ ะพะดะฝะพะฒัะตะผะตะฝะฝะพ
- ๐ **ะะพัะฐัะธั ะบะปััะตะน:** ะฐะฒัะพะผะฐัะธัะตัะบะฐั, ะฑะตะท downtime
- ๐ **ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต:** ะณะพัะธะทะพะฝัะฐะปัะฝะพะต (ะดะพะฑะฐะฒะปัะน ะฒะพัะบะตัั)
- ๐พ **ะฅัะฐะฝะตะฝะธะต:** PostgreSQL + Redis
- โฑ๏ธ **ะขะฐะนะผะฐััั:** 30 ะผะธะฝัั ะฝะฐ ะณะตะฝะตัะฐัะธั ะพะดะฝะพะณะพ ะฒะธะดะตะพ

---

## ๐ง ะะพะผะฐะฝะดั ัะฟัะฐะฒะปะตะฝะธั

### Docker Compose

```bash
# ะะฐะฟััะบ
docker-compose up -d

# ะััะฐะฝะพะฒะบะฐ
docker-compose down

# ะะตัะตะทะฐะฟััะบ
docker-compose restart

# ะะพะณะธ
docker-compose logs -f [service_name]

# ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต ะฒะพัะบะตัะพะฒ
docker-compose up --scale worker=N -d

# ะะฑะฝะพะฒะปะตะฝะธะต ะบะพะดะฐ
git pull
docker-compose build
docker-compose up -d
```

### ะัะธััะบะฐ

```bash
# ะฃะดะฐะปะธัั ะฒัะต ะบะพะฝัะตะนะฝะตัั
docker-compose down

# ะฃะดะฐะปะธัั ั volumes (ะะ ะธ Redis)
docker-compose down -v

# ะะพะปะฝะฐั ะพัะธััะบะฐ
docker-compose down -v --rmi all
```

---

## ๐ Troubleshooting

### ะะพั ะฝะต ะทะฐะฟััะบะฐะตััั

1. ะัะพะฒะตัััะต ะปะพะณะธ: `docker-compose logs bot`
2. ะฃะฑะตะดะธัะตัั ััะพ `BOT_TOKEN` ะบะพััะตะบัะฝัะน
3. ะัะพะฒะตัััะต ััะพ `PUBLIC_BASE_URL` ะดะพัััะฟะตะฝ

### ะะพัะบะตัั ะฝะต ะพะฑัะฐะฑะฐััะฒะฐัั ะทะฐะดะฐัะธ

1. ะัะพะฒะตัััะต ะปะพะณะธ: `docker-compose logs worker`
2. ะฃะฑะตะดะธัะตัั ััะพ Redis ัะฐะฑะพัะฐะตั: `docker-compose ps redis`
3. ะัะพะฒะตัััะต API ะบะปััะธ: `KIE_API_KEY` ะธ `OPENAI_API_KEY`

### ะะธะดะตะพ ะฝะต ะณะตะฝะตัะธัััััั

1. ะัะพะฒะตัััะต ะฑะฐะปะฐะฝั KIE.AI API ะบะปััะตะน
2. ะะพัะผะพััะธัะต ะพัะธะฑะบะธ ะฒ ะปะพะณะฐั ะฒะพัะบะตัะพะฒ
3. ะัะพะฒะตัััะต rate limits: ัะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพัะธััะตั ะบะปััะธ

### Rate Limit ะพัะธะฑะบะธ

- ะะพะฑะฐะฒััะต ะฑะพะปััะต API ะบะปััะตะน ะฒ `KIE_API_KEY` (ัะตัะตะท ะทะฐะฟัััั)
- ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะฑะปะพะบะธััะตั ะฟัะพะฑะปะตะผะฝัะต ะบะปััะธ
- ะัะพะฒะตัััะต health ะบะปััะตะน ะฒ ะปะพะณะฐั

---

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
neurocards-bot/
โโโ app/                    # Telegram ะฑะพั
โ   โโโ handlers/           # ะะฑัะฐะฑะพััะธะบะธ ะบะพะผะฐะฝะด ะธ callback'ะพะฒ
โ   โโโ services/           # ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โ   โ   โโโ redis_queue.py  # Redis ะพัะตัะตะดั ะทะฐะดะฐั
โ   โ   โโโ generation.py   # ะกะพะทะดะฐะฝะธะต ะทะฐะดะฐั
โ   โโโ main.py             # ะขะพัะบะฐ ะฒัะพะดะฐ ะฑะพัะฐ
โ   โโโ config.py           # ะะพะฝัะธะณััะฐัะธั
โโโ worker/                 # Background ะพะฑัะฐะฑะพััะธะบะธ
โ   โโโ video_processor.py  # ะะพะณะธะบะฐ ะณะตะฝะตัะฐัะธะธ ะฒะธะดะตะพ
โ   โโโ rq_worker.py        # RQ worker entry point
โ   โโโ kie_client.py       # KIE.AI API ะบะปะธะตะฝั
โ   โโโ kie_key_rotator.py  # ะะพัะฐัะธั API ะบะปััะตะน
โ   โโโ openai_prompter.py  # ะะตะฝะตัะฐัะธั ะฟัะพะผะฟัะพะฒ
โโโ database/               # PostgreSQL ััะตะผะฐ
โโโ scripts/                # ะฃัะธะปะธัั
โโโ docker-compose.yml      # ะัะบะตัััะฐัะธั ัะตัะฒะธัะพะฒ
โโโ Dockerfile.bot          # ะะฑัะฐะท ะฑะพัะฐ
โโโ Dockerfile.worker       # ะะฑัะฐะท ะฒะพัะบะตัะฐ
โโโ README.md               # ะญัะฐ ะดะพะบัะผะตะฝัะฐัะธั
```

---

## ๐ ะะตะทะพะฟะฐัะฝะพััั

- โ ะะตะฟัะธะฒะธะปะตะณะธัะพะฒะฐะฝะฝัะต Docker ะฟะพะปัะทะพะฒะฐัะตะปะธ
- โ Secrets ัะตัะตะท environment variables
- โ Health checks ะดะปั ะฒัะตั ัะตัะฒะธัะพะฒ
- โ Graceful shutdown
- โ Rate limiting ัะตัะตะท ัะพัะฐัะธั ะบะปััะตะน
- โ ะะทะพะปััะธั ัะตัะตะน ะฒ Docker

---

## ๐ ะะธัะตะฝะทะธั

MIT

---

## ๐ค ะะพะดะดะตัะถะบะฐ

ะัะธ ะฒะพะทะฝะธะบะฝะพะฒะตะฝะธะธ ะฟัะพะฑะปะตะผ:

1. ะัะพะฒะตัััะต ะปะพะณะธ: `docker-compose logs -f`
2. ะัะพะฒะตัััะต ััะฐััั: `docker-compose ps`
3. ะัะพะฒะตัััะต Redis: `docker-compose exec redis redis-cli ping`
4. ะัะพะฒะตัััะต ะะ: `docker-compose exec postgres pg_isready`

---

## ๐ฏ Production Checklist

ะะตัะตะด ะทะฐะฟััะบะพะผ ะฒ production:

- [ ] ะะฐัััะพะนัะต `PUBLIC_BASE_URL` ั HTTPS
- [ ] ะะพะฑะฐะฒััะต 5+ API ะบะปััะตะน ะดะปั KIE.AI
- [ ] ะฃััะฐะฝะพะฒะธัะต `WORKER_REPLICAS` ะฟะพ ะฝะฐะณััะทะบะต
- [ ] ะะฐัััะพะนัะต backup PostgreSQL
- [ ] ะะฐัััะพะนัะต ะผะพะฝะธัะพัะธะฝะณ (Prometheus/Grafana)
- [ ] ะะฐัััะพะนัะต reverse proxy (nginx/Caddy)
- [ ] ะะฐัััะพะนัะต firewall
- [ ] ะัะฟะพะปัะทัะนัะต Docker Swarm ะธะปะธ Kubernetes ะดะปั ะพัะบะตัััะฐัะธะธ
